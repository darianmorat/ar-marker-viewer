<!-- <!DOCTYPE html> -->
<!-- <html lang="en"> -->
<!---->
<!-- <head> -->
<!--    <meta charset="UTF-8"> -->
<!--    <meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
<!--    <title>AR Model Viewer</title> -->
<!--    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script> -->
<!--    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script> -->
<!--    <style> -->
<!--       body { -->
<!--          text-align: center; -->
<!--          padding: 20px; -->
<!--       } -->
<!---->
<!--       #scanning-overlay { -->
<!--          position: fixed; -->
<!--          top: 0; -->
<!--          left: 0; -->
<!--          width: 100%; -->
<!--          height: 100%; -->
<!--          background: rgba(0, 0, 0, 0.7); -->
<!--          color: white; -->
<!--          display: flex; -->
<!--          flex-direction: column; -->
<!--          justify-content: center; -->
<!--          align-items: center; -->
<!--          z-index: 9999; -->
<!--          font-family: Arial, sans-serif; -->
<!--       } -->
<!---->
<!--       .hidden { -->
<!--          display: none !important; -->
<!--       } -->
<!---->
<!--       #marker-image { -->
<!--          width: 220px; -->
<!--          height: 220px; -->
<!--          margin: 35px; -->
<!--          opacity: 0.5; -->
<!--       } -->
<!---->
<!--       .marker-container { -->
<!--          position: relative; -->
<!--          display: inline-block; -->
<!--          margin: 10px; -->
<!--          margin-bottom: 30px; -->
<!--       } -->
<!---->
<!--       .marker-container::before, -->
<!--       .marker-container::after, -->
<!--       .corner-top-left, -->
<!--       .corner-top-right { -->
<!--          content: ''; -->
<!--          position: absolute; -->
<!--          width: 23px; -->
<!--          height: 23px; -->
<!--          border-color: red; -->
<!--          border-style: solid; -->
<!--          z-index: 1; -->
<!--       } -->
<!---->
<!--       .corner-top-left { -->
<!--          top: 20px; -->
<!--          left: 20px; -->
<!--          border-width: 3px 0 0 3px; -->
<!--       } -->
<!---->
<!--       .corner-top-right { -->
<!--          top: 20px; -->
<!--          right: 20px; -->
<!--          border-width: 3px 3px 0 0; -->
<!--       } -->
<!---->
<!--       .marker-container::before { -->
<!--          bottom: 20px; -->
<!--          left: 20px; -->
<!--          border-width: 0 0 3px 3px; -->
<!--       } -->
<!---->
<!--       .marker-container::after { -->
<!--          bottom: 20px; -->
<!--          right: 20px; -->
<!--          border-width: 0 3px 3px 0; -->
<!--       } -->
<!---->
<!--       .text>p { -->
<!--          margin: 0; -->
<!--       } -->
<!--    </style> -->
<!-- </head> -->
<!---->
<!-- <body> -->
<!--    <div id="scanning-overlay"> -->
<!--       <h1>Apunta tu camara a este marcador:</h1> -->
<!--       <div class="marker-container"> -->
<!--          <span class="corner-top-left"></span> -->
<!--          <span class="corner-top-right"></span> -->
<!--          <img id="marker-image" src="./mark.png" alt="AR Marker"> -->
<!--       </div> -->
<!--       <div class="text"> -->
<!--          <p>Apunta tu camara y espera hasta que el modelo aparezca...</p> -->
<!--       </div> -->
<!--    </div> -->
<!---->
<!--    <a-scene arjs vr-mode-ui="enabled: false"> -->
<!--       <a-marker type="pattern" url="./mark.patt" id="marker" markerhandler> -->
<!--          <a-entity id="model-entity" position="0 0 0" scale="1"></a-entity> -->
<!--       </a-marker> -->
<!--       <a-entity camera></a-entity> -->
<!--    </a-scene> -->
<!---->
<!--    <script> -->
<!--       const models = [ -->
<!--          "./models/liz1.glb", -->
<!--          "./models/liz2.glb", -->
<!--          "./models/liz3.glb", -->
<!--          "./models/liz4.glb", -->
<!--          "./models/liz5.glb", -->
<!--          "./models/liz6.glb", -->
<!--       ]; -->
<!--       let modelIndex = 0; -->
<!---->
<!--       const modelEntity = document.getElementById('model-entity'); -->
<!--       const overlay = document.getElementById('scanning-overlay'); -->
<!---->
<!--       overlay.classList.remove('hidden'); -->
<!---->
<!--       document.querySelector('a-marker').addEventListener('markerFound', () => { -->
<!--          overlay.classList.add('hidden'); -->
<!--       }); -->
<!---->
<!--       document.querySelector('a-marker').addEventListener('markerLost', () => { -->
<!--          overlay.classList.remove('hidden'); -->
<!--       }); -->
<!---->
<!--       function changeModel() { -->
<!--          modelEntity.removeAttribute('gltf-model'); -->
<!--          modelEntity.setAttribute('gltf-model', models[modelIndex]); -->
<!--          modelIndex = (modelIndex + 1) % models.length; -->
<!--       } -->
<!---->
<!--       changeModel(); -->
<!--       setInterval(changeModel, 5000); -->
<!--    </script> -->
<!-- </body> -->
<!---->
<!-- </html> -->

<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="mobile-web-app-capable" content="yes">
   <title>AR Model Viewer</title>
   <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
   <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
   <style>
      body {
         text-align: center;
         padding: 20px;
         margin: 0;
         overflow: hidden;
      }
      #scanning-overlay {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: rgba(0, 0, 0, 0.7);
         color: white;
         display: flex;
         flex-direction: column;
         justify-content: center;
         align-items: center;
         z-index: 9999;
         font-family: Arial, sans-serif;
      }
      .hidden {
         display: none !important;
      }
      #marker-image {
         width: 220px;
         height: 220px;
         margin: 35px;
         opacity: 0.5;
      }
      .marker-container {
         position: relative;
         display: inline-block;
         margin: 10px;
         margin-bottom: 30px;
      }
      .marker-container::before,
      .marker-container::after,
      .corner-top-left,
      .corner-top-right {
         content: '';
         position: absolute;
         width: 23px;
         height: 23px;
         border-color: red;
         border-style: solid;
         z-index: 1;
      }
      .corner-top-left {
         top: 20px;
         left: 20px;
         border-width: 3px 0 0 3px;
      }
      .corner-top-right {
         top: 20px;
         right: 20px;
         border-width: 3px 3px 0 0;
      }
      .marker-container::before {
         bottom: 20px;
         left: 20px;
         border-width: 0 0 3px 3px;
      }
      .marker-container::after {
         bottom: 20px;
         right: 20px;
         border-width: 0 3px 3px 0;
      }
      .text>p {
         margin: 0;
      }
      #loading-indicator {
         position: fixed;
         bottom: 20px;
         left: 50%;
         transform: translateX(-50%);
         background-color: rgba(0, 0, 0, 0.7);
         color: white;
         padding: 10px 20px;
         border-radius: 20px;
         z-index: 9998;
      }
      #model-info {
         position: fixed;
         top: 20px;
         left: 50%;
         transform: translateX(-50%);
         background-color: rgba(0, 0, 0, 0.7);
         color: white;
         padding: 5px 15px;
         border-radius: 15px;
         z-index: 9997;
         font-family: Arial, sans-serif;
         font-size: 14px;
      }
   </style>
</head>
<body>
   <div id="scanning-overlay">
      <h1>Apunta tu camara a este marcador:</h1>
      <div class="marker-container">
         <span class="corner-top-left"></span>
         <span class="corner-top-right"></span>
         <img id="marker-image" src="./mark.png" alt="AR Marker">
      </div>
      <div class="text">
         <p>Apunta tu camara y espera hasta que el modelo aparezca...</p>
      </div>
   </div>
   
   <div id="loading-indicator" class="hidden">
      <p>Cargando modelo...</p>
   </div>
   
   <div id="model-info" class="hidden">
      <p id="model-name">Modelo 1</p>
   </div>
   
   <a-scene arjs="detectionMode: mono_and_matrix; matrixCodeType: 3x3; debugUIEnabled: false;" vr-mode-ui="enabled: false">
      <a-marker type="pattern" url="./mark.patt" id="marker" markerhandler>
         <a-entity id="model-entity" position="0 0 0" scale="1"></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
   </a-scene>
   
   <script>
      const models = [
         "./models/liz1.glb",
         "./models/liz2.glb",
         "./models/liz3.glb",
         "./models/liz4.glb",
         "./models/liz5.glb",
         "./models/liz6.glb",
      ];
      
      const modelNames = [
         "Lizard 1",
         "Lizard 2",
         "Lizard 3",
         "Lizard 4",
         "Lizard 5",
         "Lizard 6"
      ];
      
      let modelIndex = 0;
      let isModelLoading = false;
      let markerVisible = false;
      
      const modelEntity = document.getElementById('model-entity');
      const overlay = document.getElementById('scanning-overlay');
      const loadingIndicator = document.getElementById('loading-indicator');
      const modelInfo = document.getElementById('model-info');
      const modelNameElem = document.getElementById('model-name');
      
      // Show overlay initially
      overlay.classList.remove('hidden');
      
      // Set up canvas for better performance
      window.addEventListener('load', () => {
         setTimeout(() => {
            document.querySelectorAll('canvas').forEach(canvas => {
               const ctx = canvas.getContext('2d', {willReadFrequently: true});
            });
         }, 1000);
      });
      
      // Marker detection events
      document.querySelector('a-marker').addEventListener('markerFound', () => {
         overlay.classList.add('hidden');
         markerVisible = true;
         if (!isModelLoading) {
            modelInfo.classList.remove('hidden');
         }
      });
      
      document.querySelector('a-marker').addEventListener('markerLost', () => {
         overlay.classList.remove('hidden');
         modelInfo.classList.add('hidden');
         markerVisible = false;
      });
      
      // Progressive model loading
      function changeModel() {
         if (isModelLoading) return;
         
         isModelLoading = true;
         loadingIndicator.classList.remove('hidden');
         modelInfo.classList.add('hidden');
         
         setTimeout(() => {
            modelEntity.removeAttribute('gltf-model');
            
            // Set a timeout before trying to load the next model
            setTimeout(() => {
               modelNameElem.textContent = modelNames[modelIndex];
               modelEntity.setAttribute('gltf-model', models[modelIndex]);
               
               modelIndex = (modelIndex + 1) % models.length;
            }, 300);
         }, 100);
      }
      
      // Model loaded event
      modelEntity.addEventListener('model-loaded', () => {
         isModelLoading = false;
         loadingIndicator.classList.add('hidden');
         
         if (markerVisible) {
            modelInfo.classList.remove('hidden');
         }
         
         console.log("Model loaded successfully:", models[(modelIndex - 1 + models.length) % models.length]);
      });
      
      // Model error handling
      modelEntity.addEventListener('model-error', (e) => {
         console.error("Error loading model:", e.detail.src);
         isModelLoading = false;
         loadingIndicator.classList.add('hidden');
         
         // Skip to next model on error
         modelIndex = (modelIndex + 1) % models.length;
         setTimeout(changeModel, 1000);
      });
      
      // Initial model load
      changeModel();
      
      // Set up model rotation with proper timing
      let rotationInterval = setInterval(() => {
         if (!isModelLoading) {
            changeModel();
         }
      }, 5000);
      
      // Handle device orientation changes
      window.addEventListener('orientationchange', () => {
         setTimeout(() => {
            const scene = document.querySelector('a-scene');
            if (scene) {
               scene.resize();
            }
         }, 200);
      });
   </script>
</body>
</html>
